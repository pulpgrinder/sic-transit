<!DOCTYPE html>
<html lang="en">
<!-- Sic Transit Demo. Copyright 2023 by Anthony W. Hursh. MIT license -->
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-store,must-revalidate,max-age=-1">
    <meta http-equiv="Pragma" content="no-store">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="sic-transit.css">
    <link rel="stylesheet" href="sic-demo.css">
    <script type="text/javascript" src="sic-transit.js"></script>
    <script type="text/javascript" src="markdown-it.min.js"></script>
    <title>Sic Transit Demo</title>
  </head>
  <body>
    <div id="mainscreen">
      <div id="demodiv">
        <div id='firstcontainer'>
          <div id='panel1' class='demopanel'>
          <h4>#panel1 says "Hello!"</h4>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus luctus urna sed urna ultricies ac tempor dui sagittis. In condimentum facilisis porta.
          </div>
          <div id='panel2' class='demopanel'>
          <h4>#panel2 says "Bonjour!"</h4>
          Sed leo enim, condimentum et vehicula vel, facilisis sit amet leo. Nam non dui nec nulla suscipit suscipit in id urna. Praesent dapibus neque id cursus faucibus.
          </div>
          <div id='panel3' class='demopanel'>
          <h4>#panel3 says "Guten Tag!"</h4>
          Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae. Fusce id purus turpis, vitae venenatis urna. Nullam quis ante et metus fringilla malesuada.
          </div>
          <div id='panel4' class='demopanel'>
          <h4>#panel4 says "Hola!"</h4>
          Aliquam erat volutpat. Nulla facilisi. Suspendisse potenti. Morbi in sem quis dui placerat ornare. Pellentesque odio nisi, euismod in, pharetra a, ultricies in, diam. Sed arcu. Cras consequat.
          </div>
        </div>
        <div id="panel5"">
          <h4>This is #panel5</h4>
          It's outside of the Sic Transit container to start with, but we'll move it into the container in one of the examples in the docs.
        </div>
        <div id="panel6"">
          <h4>This is #panel6</h4>
          It's outside of the Sic Transit container to start with, but we'll move it into the container in one of the examples in the docs.
        </div>
       </div>
      <div id="docwrapper">
        <div id="docs">
        </div>
      </div>
    </div>
  </body>  
  
    <script type="text/javascript">
        let logger = null;
        let oldLog = console.log;
        let oldError = console.error;
        let firstSic = new SicTransit("#firstcontainer",".demopanel");
        async function loadDocs(){
          const response = await fetch("documentation.md");
          let doctext = await response.text();
          let demoinstance = 0;
          doctext = doctext.replace(/```javascript[\s\S]*?```/g,function(match) {
                      demoinstance++;
                      return match + "\n<div class='demoresult' id='demoresult-" + demoinstance + "'></div>\n<div><button onclick='runDemo(" + demoinstance + ")'>Run</button></div>";
                    });
        let md = window.markdownit({
              html: true
        });
        let html = md.render(doctext);
        document.getElementById("docs").innerHTML = html;
        let codeSamples = document.querySelectorAll(".language-javascript");
        for(let i=0;i < codeSamples.length; i++){
          // Set up editors.
          codeSamples[i].setAttribute("contenteditable","true");

          // Try to keep HTML garbage from being pasted into the code editors.
          // If only there were a standard for contenteditable plaintext-only that worked the same across browsers...sigh.
          codeSamples[i].addEventListener('paste', function(e) {
            e.preventDefault();
            let text = (e.originalEvent || e).clipboardData.getData('text/plain');
          document.execCommand('insertText', false, text);
          });

        }
      }
      loadDocs();
     
      function runDemo(index){
          // Yes, I know. We actually want to allow the execution of random code here. IN THIS CASE, it's safe. There are no credentials or cross-site issues involved.
          logger = document.getElementById("demoresult-" + index);
          let code = document.getElementById("demoresult-" + index).previousElementSibling.innerText;
          try {
            let codeResult = eval(code);
            if(codeResult !== undefined){
              console.log(codeResult) + "\n";
            }
            else{
              console.log("(no errors)\n");
            }

          } catch (e) {
            logger.innerText = e.message
          }
          
        }
        console.log = function(message) {
          if(logger !== null){
            if(message instanceof HTMLElement) {
                logger.innerHTML = "[HTMLElement]";
              }
             else if(typeof message == 'object') {
                logger.innerHTML = JSON.stringify(message);
              }
              else {
                logger.innerHTML = message;
              }
          }
        oldLog.apply(console, arguments);
      }
      console.error = function(message) {
        if(logger !== null){
            if(message instanceof HTMLElement) {
                logger.innerHTML = "[HTMLElement]";
              }
             else if(typeof message == 'object') {
                logger.innerHTML = JSON.stringify(message) + "\n";
              }
              else {
                logger.innerHTML = message;
              }
        }
        oldError.apply(console, arguments);
      }

    </script>
  </script>
 </html>